import { RESTAURANTS } from '@/lib/restaurant-data'

export default function PaymentMixKPI() {
  // FIN_013 Cash vs. Digital Payment Mix % - Exact specifications from restaurant_kpi_metrics_127.txt
  const paymentData = [
    {
      restaurant: RESTAURANTS[0], // Chanakyapuri
      totalRevenue: 485000,
      paymentBreakdown: {
        upi: 315250, // 65%
        cards: 121250, // 25%
        cash: 24250, // 5%
        wallets: 24250 // 5%
      },
      paymentPercentages: {
        upi: 65.0,
        cards: 25.0,
        cash: 5.0,
        wallets: 5.0
      },
      cashVariance: -2.0, // 2% below expected 7%
      status: 'excellent', // Low cash variance
      eodReconciliation: {
        expectedCash: 26950, // Based on 7% typical
        actualCash: 24250,
        variance: -2700,
        reconciled: true
      },
      digitalPaymentTotal: 460750 // 95%
    },
    {
      restaurant: RESTAURANTS[1], // Gurugram
      totalRevenue: 395000,
      paymentBreakdown: {
        upi: 237000, // 60%
        cards: 118500, // 30%
        cash: 27650, // 7%
        wallets: 11850 // 3%
      },
      paymentPercentages: {
        upi: 60.0,
        cards: 30.0,
        cash: 7.0,
        wallets: 3.0
      },
      cashVariance: 0.0, // Exactly at expected 7%
      status: 'excellent',
      eodReconciliation: {
        expectedCash: 27650,
        actualCash: 27650,
        variance: 0,
        reconciled: true
      },
      digitalPaymentTotal: 367350 // 93%
    },
    {
      restaurant: RESTAURANTS[2], // Shahpur Jat
      totalRevenue: 365000,
      paymentBreakdown: {
        upi: 182500, // 50%
        cards: 109500, // 30%
        cash: 54750, // 15% - High cash usage
        wallets: 18250 // 5%
      },
      paymentPercentages: {
        upi: 50.0,
        cards: 30.0,
        cash: 15.0,
        wallets: 5.0
      },
      cashVariance: 8.0, // 8% above expected 7%
      status: 'warning', // High cash variance needs investigation
      eodReconciliation: {
        expectedCash: 25550, // Based on 7% typical
        actualCash: 54750,
        variance: 29200,
        reconciled: false
      },
      digitalPaymentTotal: 310250 // 85%
    }
  ]

  const chainTotalRevenue = paymentData.reduce((sum, item) => sum + item.totalRevenue, 0)
  const chainTotalCash = paymentData.reduce((sum, item) => sum + item.paymentBreakdown.cash, 0)
  const chainCashPercentage = (chainTotalCash / chainTotalRevenue) * 100
  const chainTotalUPI = paymentData.reduce((sum, item) => sum + item.paymentBreakdown.upi, 0)
  const chainUPIPercentage = (chainTotalUPI / chainTotalRevenue) * 100
  const locationsWithCashVariance = paymentData.filter(item => Math.abs(item.cashVariance) > 2).length

  const getStatusColor = (variance: number) => {
    if (Math.abs(variance) <= 2) return 'text-green-600'
    if (Math.abs(variance) <= 5) return 'text-yellow-600'
    return 'text-red-600'
  }

  const getStatusBg = (variance: number) => {
    if (Math.abs(variance) <= 2) return 'bg-green-50 dark:bg-green-900/20 border-green-200'
    if (Math.abs(variance) <= 5) return 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200'
    return 'bg-red-50 dark:bg-red-900/20 border-red-200'
  }

  const getStatusIcon = (variance: number) => {
    if (Math.abs(variance) <= 2) return 'check'
    if (Math.abs(variance) <= 5) return 'alert'
    return 'warning'
  }

  return (
    <div className="space-y-6">
      {/* Header with KPI ID */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-xs font-bold text-black dark:text-white">
            Cash vs. Digital Payment Mix %
          </h1>
          <p className="text-xs font-normal text-gray-500 mt-1">
            KPI ID: FIN_013 | Working Capital Management & Fraud Risk Indicator
          </p>
        </div>
      </div>

      {/* Definition & Formula Card */}
      <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200">
        <h2 className="text-xs font-bold text-blue-900 dark:text-blue-300 mb-2">
          üìä Definition & Formula
        </h2>
        <div className="space-y-2">
          <p className="text-xs font-normal text-blue-800 dark:text-blue-300">
            <strong>Formula:</strong> Payment breakdown: (Cash √∑ Total) %, (UPI √∑ Total) %, (Cards √∑ Total) %, (Wallets √∑ Total) %
          </p>
          <p className="text-xs font-normal text-blue-800 dark:text-blue-300">
            <strong>Definition:</strong> Percentage breakdown of payments by type. Indicator of working capital and fraud risk.
          </p>
          <p className="text-xs font-normal text-blue-800 dark:text-blue-300">
            <strong>Why Critical:</strong> Useful for working capital management; cash variance >2% warrants investigation for theft or error.
          </p>
        </div>
      </div>

      {/* Alert Thresholds */}
      <div className="bg-card p-4 rounded-lg border">
        <h2 className="text-xs font-bold text-black dark:text-white mb-4">
          üéØ Target Ranges & Alert Thresholds
        </h2>
        <div className="grid grid-cols-3 gap-4">
          <div className="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded border border-green-200">
            <div className="text-xs font-bold text-green-700 dark:text-green-300">TARGET</div>
            <div className="text-xs font-normal text-green-600">UPI 50‚Äì70%, Cards 20‚Äì30%, Cash 5‚Äì15%</div>
          </div>
          <div className="text-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded border border-yellow-200">
            <div className="text-xs font-bold text-yellow-700 dark:text-yellow-300">WARNING</div>
            <div className="text-xs font-normal text-yellow-600">Cash variance >2%, UPI <40%</div>
          </div>
          <div className="text-center p-3 bg-red-50 dark:bg-red-900/20 rounded border border-red-200">
            <div className="text-xs font-bold text-red-700 dark:text-red-300">CRITICAL</div>
            <div className="text-xs font-normal text-red-600">Cash variance >5%, extreme shifts</div>
          </div>
        </div>
      </div>

      {/* Chain Summary */}
      <div className="bg-card p-4 rounded-lg border">
        <h2 className="text-xs font-bold text-black dark:text-white mb-4">
          üìà Chain Payment Mix Summary
        </h2>
        <div className="grid grid-cols-4 gap-6">
          <div>
            <span className="text-xs font-normal text-gray-500">Chain UPI %</span>
            <div className="flex items-center gap-2">
              <span className="text-xs font-bold text-blue-600">
                {chainUPIPercentage.toFixed(1)}%
              </span>
              <span>üì±</span>
            </div>
          </div>
          <div>
            <span className="text-xs font-normal text-gray-500">Chain Cash %</span>
            <div className="flex items-center gap-2">
              <span className={`text-xs font-bold ${chainCashPercentage > 10 ? 'text-red-600' : 'text-green-600'}`}>
                {chainCashPercentage.toFixed(1)}%
              </span>
              <span>üíµ</span>
            </div>
          </div>
          <div>
            <span className="text-xs font-normal text-gray-500">Total Cash Handled</span>
            <div className="flex items-center gap-2">
              <span className="text-xs font-bold text-black dark:text-white">
                ‚Çπ{chainTotalCash.toLocaleString('en-IN')}
              </span>
              <span>üí∞</span>
            </div>
          </div>
          <div>
            <span className="text-xs font-normal text-gray-500">Locations with Variance</span>
            <div className="text-xs font-normal text-red-600">
              {locationsWithCashVariance}/3 locations >2% variance
            </div>
          </div>
        </div>
      </div>

      {/* Payment Mix Analysis by Location */}
      <div className="bg-card p-4 rounded-lg border">
        <h2 className="text-xs font-bold text-black dark:text-white mb-4">
          üè¶ Payment Mix Analysis by Location
        </h2>
        <div className="space-y-3">
          {paymentData
            .sort((a, b) => a.paymentPercentages.cash - b.paymentPercentages.cash)
            .map((location, index) => (
            <div key={location.restaurant.id} className={`p-3 rounded border ${getStatusBg(location.cashVariance)}`}>
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center gap-3">
                  <span className="text-xs font-normal text-gray-500">#{index + 1}</span>
                  <span className="text-xs font-bold text-black dark:text-white">
                    {location.restaurant.fullName}
                  </span>
                  <span>{getStatusIcon(location.cashVariance)}</span>
                </div>
                <div className="text-right">
                  <div className={`text-xs font-bold ${getStatusColor(location.cashVariance)}`}>
                    {location.cashVariance > 0 ? '+' : ''}{location.cashVariance.toFixed(1)}%
                  </div>
                  <div className="text-xs font-normal text-gray-500">
                    Cash variance
                  </div>
                </div>
              </div>
              
              {/* Payment method breakdown */}
              <div className="grid grid-cols-4 gap-4 mb-3 text-xs">
                <div className="text-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded">
                  <div className="text-blue-600 font-bold">UPI</div>
                  <div className="font-normal text-black dark:text-white">{location.paymentPercentages.upi.toFixed(1)}%</div>
                  <div className="text-gray-500">‚Çπ{location.paymentBreakdown.upi.toLocaleString('en-IN')}</div>
                </div>
                <div className="text-center p-2 bg-green-50 dark:bg-green-900/20 rounded">
                  <div className="text-green-600 font-bold">Cards</div>
                  <div className="font-normal text-black dark:text-white">{location.paymentPercentages.cards.toFixed(1)}%</div>
                  <div className="text-gray-500">‚Çπ{location.paymentBreakdown.cards.toLocaleString('en-IN')}</div>
                </div>
                <div className="text-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded">
                  <div className="text-orange-600 font-bold">Cash</div>
                  <div className={`font-normal ${location.paymentPercentages.cash > 10 ? 'text-red-600' : 'text-black dark:text-white'}`}>
                    {location.paymentPercentages.cash.toFixed(1)}%
                  </div>
                  <div className="text-gray-500">‚Çπ{location.paymentBreakdown.cash.toLocaleString('en-IN')}</div>
                </div>
                <div className="text-center p-2 bg-purple-50 dark:bg-purple-900/20 rounded">
                  <div className="text-purple-600 font-bold">Wallets</div>
                  <div className="font-normal text-black dark:text-white">{location.paymentPercentages.wallets.toFixed(1)}%</div>
                  <div className="text-gray-500">‚Çπ{location.paymentBreakdown.wallets.toLocaleString('en-IN')}</div>
                </div>
              </div>

              {/* EOD Reconciliation */}
              <div className="mt-3 pt-2 border-t border-gray-200 dark:border-gray-700">
                <h4 className="text-xs font-bold text-gray-600 mb-2">End-of-Day Cash Reconciliation</h4>
                <div className="grid grid-cols-4 gap-4 text-xs">
                  <div>
                    <span className="text-gray-500">Expected Cash:</span>
                    <div className="font-normal text-black dark:text-white">‚Çπ{location.eodReconciliation.expectedCash.toLocaleString('en-IN')}</div>
                  </div>
                  <div>
                    <span className="text-gray-500">Actual Cash:</span>
                    <div className="font-normal text-black dark:text-white">‚Çπ{location.eodReconciliation.actualCash.toLocaleString('en-IN')}</div>
                  </div>
                  <div>
                    <span className="text-gray-500">Variance:</span>
                    <div className={`font-normal ${location.eodReconciliation.variance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                      {location.eodReconciliation.variance >= 0 ? '+' : ''}‚Çπ{location.eodReconciliation.variance.toLocaleString('en-IN')}
                    </div>
                  </div>
                  <div>
                    <span className="text-gray-500">Status:</span>
                    <div className={`font-normal ${location.eodReconciliation.reconciled ? 'text-green-600' : 'text-red-600'}`}>
                      {location.eodReconciliation.reconciled ? 'Reconciled' : 'Needs Review'}
                    </div>
                  </div>
                </div>
              </div>

              {/* Digital payment summary */}
              <div className="mt-2 text-xs">
                <span className="text-gray-500">Total Digital Payments:</span>
                <span className="ml-2 font-bold text-green-600">
                  ‚Çπ{location.digitalPaymentTotal.toLocaleString('en-IN')} ({((location.digitalPaymentTotal / location.totalRevenue) * 100).toFixed(1)}%)
                </span>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Payment Method Trends */}
      <div className="bg-card p-4 rounded-lg border">
        <h2 className="text-xs font-bold text-black dark:text-white mb-4">
          üìä Daily Payment Mix Trend (This Week %)
        </h2>
        <div className="space-y-3">
          <div className="grid grid-cols-8 gap-2 text-xs">
            <div className="font-bold text-gray-600">Payment</div>
            {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (
              <div key={day} className="font-bold text-gray-600 text-center">{day}</div>
            ))}
          </div>
          
          <div className="grid grid-cols-8 gap-2 text-xs">
            <div className="text-blue-600 font-bold">UPI</div>
            {[62, 64, 65, 63, 61, 58, 59].map((value, idx) => (
              <div key={idx} className="text-center p-1 bg-blue-100 text-blue-600 rounded">{value}%</div>
            ))}
          </div>
          
          <div className="grid grid-cols-8 gap-2 text-xs">
            <div className="text-green-600 font-bold">Cards</div>
            {[28, 27, 26, 28, 29, 30, 28].map((value, idx) => (
              <div key={idx} className="text-center p-1 bg-green-100 text-green-600 rounded">{value}%</div>
            ))}
          </div>
          
          <div className="grid grid-cols-8 gap-2 text-xs">
            <div className="text-orange-600 font-bold">Cash</div>
            {[7, 6, 6, 6, 7, 9, 10].map((value, idx) => (
              <div key={idx} className={`text-center p-1 rounded ${value > 8 ? 'bg-red-100 text-red-600' : 'bg-orange-100 text-orange-600'}`}>{value}%</div>
            ))}
          </div>
          
          <div className="grid grid-cols-8 gap-2 text-xs">
            <div className="text-purple-600 font-bold">Wallets</div>
            {[3, 3, 3, 3, 3, 3, 3].map((value, idx) => (
              <div key={idx} className="text-center p-1 bg-purple-100 text-purple-600 rounded">{value}%</div>
            ))}
          </div>
        </div>
        <div className="mt-2 text-xs text-gray-500">
          Note: Weekend cash payments typically higher due to customer preference
        </div>
      </div>

      {/* Data Sources & Refresh */}
      <div className="bg-card p-4 rounded-lg border">
        <h2 className="text-xs font-bold text-black dark:text-white mb-4">
          üîÑ Data Sources & Refresh Schedule
        </h2>
        <div className="grid grid-cols-2 gap-6">
          <div className="space-y-2">
            <h3 className="text-xs font-bold text-black dark:text-white">Data Sources:</h3>
            <ul className="text-xs font-normal text-gray-500 space-y-1">
              <li>‚Ä¢ PetPooja POS /orders (payment_mode field)</li>
              <li>‚Ä¢ Bank reconciliation reports</li>
              <li>‚Ä¢ Cash register EOD counts</li>
            </ul>
          </div>
          <div className="space-y-2">
            <h3 className="text-xs font-bold text-black dark:text-white">Refresh Schedule:</h3>
            <ul className="text-xs font-normal text-gray-500 space-y-1">
              <li>‚Ä¢ Daily</li>
              <li>‚Ä¢ Alert: Red if cash variance >2%</li>
              <li>‚Ä¢ Drill down: by payment method, by location, by daypart</li>
            </ul>
          </div>
        </div>
      </div>

      {/* India-Specific Considerations */}
      <div className="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200">
        <h2 className="text-xs font-bold text-orange-900 dark:text-orange-300 mb-2">
          üáÆüá≥ India-Specific Monitoring
        </h2>
        <div className="space-y-1">
          <p className="text-xs font-normal text-orange-800 dark:text-orange-300">
            ‚Ä¢ UPI-dominant in metros (50‚Äì70%); cash variance >2% requires investigation
          </p>
          <p className="text-xs font-normal text-orange-800 dark:text-orange-300">
            ‚Ä¢ Critical for EOD reconciliation and theft prevention
          </p>
          <p className="text-xs font-normal text-orange-800 dark:text-orange-300">
            ‚Ä¢ Monitor digital payment failures and customer payment preferences
          </p>
        </div>
      </div>

      {/* Users & Access */}
      <div className="bg-gray-50 dark:bg-gray-900/20 p-4 rounded-lg border border-gray-200">
        <h2 className="text-xs font-bold text-black dark:text-white mb-2">
          üë• Authorized Users
        </h2>
        <p className="text-xs font-normal text-gray-500">
          Finance, Manager
        </p>
      </div>
    </div>
  )
}